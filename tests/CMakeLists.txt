# Partially generated by ChatGPT-3.5

# Include FetchContent module
include(FetchContent)

# Define a CMake function to fetch and link against CppUTest
function(IncludeCppUTest)
    FetchContent_Declare(
        cpputest
        GIT_REPOSITORY https://github.com/cpputest/cpputest.git
        GIT_TAG        v4.0
    )

    FetchContent_GetProperties(cpputest)
    if(NOT cpputest_POPULATED)
        FetchContent_Populate(cpputest)
        add_subdirectory(${cpputest_SOURCE_DIR} ${cpputest_BINARY_DIR})
    endif()
    target_link_libraries(${ARGV} CppUTest CppUTestExt)
endfunction()

set(PROJECT_TEST_DIRECTORY "${PROJECT_SOURCE_DIR}/tests/")

set(TEST_USERS_SRC
    "${PROJECT_TEST_DIRECTORY}/testUsers.cpp"
    "${PROJECT_SOURCE_DIR}/src/user.cpp"
    "${PROJECT_SOURCE_DIR}/src/users.cpp"
    )

# Add your test executable target
add_executable(TEST_USERS "${TEST_USERS_SRC}")

target_include_directories(TEST_USERS PRIVATE
  "${PROJECT_SOURCE_DIR}/include"
  "${PROJECT_BINARY_DIR}/include")

target_link_libraries(TEST_USERS
  "${PAM_LIBRARIES}"
  spdlog::spdlog)

# Include CppUTest only for testing
IncludeCppUTest(TEST_USERS)

# Register your test target with CTest
add_test(NAME Users COMMAND TEST_USERS)
